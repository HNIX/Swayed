<div class="card-panel">
  <div class="card-inner pb-0">
    <div class="sm:flex sm:items-center">
      <div class="flex">
        <span class="mr-3 -mx-2 m-auto text-gray-950 dark:text-white">Show</span>
        <%= form_with url: "", method: :get, data: { turbo_frame: "campaigns", turbo_action: "advance" } do |form| %>
              <%= form.select :count, options_for_select([5, 10, 25, 50, 100], selected: params[:count]), {}, { onchange: "this.form.requestSubmit()" } %>
        <% end %>
      </div>
      <div class="sm:flex-auto">
      </div>

      <div class="mt-3 sm:ml-4 sm:mt-0">
        <label for="mobile-search-candidate" class="sr-only">Search</label>
        <label for="desktop-search-candidate" class="sr-only">Search</label>
        <div class="flex rounded-md">
          <div class="relative flex-grow focus-within:z-10">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
              </svg>
            </div>
            
            <%= form_with url: "", method: :get, data: { turbo_frame: "campaigns", turbo_action: "advance" } do |form| %>
              <%= form.search_field :query, placeholder: "Search campaigns", value: params[:query], oninput: "this.form.requestSubmit()", class: "pl-10 w-full rounded-md border-0 bg-white/5 py-1.5 text-gray-900 dark:text-white shadow-sm ring-1 ring-inset dark:ring-white/10 ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6" %>
            <% end %>

          </div>
          
        </div>
      </div>

      <div class="mt-4 sm:ml-6 sm:mt-0 sm:flex-none">
        <%= link_to "New Campaign", new_campaign_path, class: "block rounded-md bg-indigo-500 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500" %>
      </div>
    </div>
    <div class="mt-4 flow-root">
      <div class="-mx-2 -my-2 overflow-x-hidden hover:overflow-x-auto sm:-mx-4 lg:-mx-8">
        <div class="inline-block min-w-full py-2 align-middle">
          <% if @campaigns.present? %>
            <%= turbo_frame_tag "campaigns" do %>
              <table class="min-w-full">
                <colgroup>
                  <col class="w-full sm:w-1/2">
                  <col class="sm:w-1/12">
                  <col class="sm:w-1/12">
                  <col class="sm:w-1/12">
                  <col class="sm:w-1/12">
                  <col class="sm:w-1/12">
                  <col class="sm:w-1/12">            
                </colgroup>
                <thead class="border-b dark:border-gray-400/10 border-gray-300">
                  <tr class="dark:text-white">
                    <th scope="col" class="whitespace-nowrap py-3.5 pl-6 pr-3 text-left text-sm font-semibold text-gray-900">
                      <%= sort_link_to "Campaign name", :name, data: { turbo_action: "advance" } %>
                    </th>
                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900">
                    </th>
                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-200">
                      Revenue
                    </th>
                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-200">Profit</th>

                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-200">24hr %</th>

                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-200">Requests</th>
                    <th scope="col" class="whitespace-nowrap px-2 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-gray-200">Accepted</th>
                  </tr>
                </thead>
                <tbody class="text-gray-700 text-sm">
                    <% @campaigns.each do |campaign| %>
                    <tr class="even:bg-slate-400/5">
                      <td class="whitespace-nowrap py-4 pl-6 pr-3 text-sm text-gray-500 flex">  
                          <%= link_to campaign.name, campaign_path(campaign), data: { turbo: false }, class: "text-gray-950 hover:text-indigo-500 dark:hover:text-indigo-500 dark:text-gray-200" %>

                          <div class="ml-4 flex items-center justify-end gap-x-2 sm:justify-start mr-3">
                            <div class="inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset <%= status_color_class(campaign.status) %>">
                              <%= campaign.status %>
                            </div>
                          </div>                          
                      </td> 
              
                      <td class="whitespace-nowrap px-2 py-2 text-sm text-gray-500 dark:text-gray-200"></td>
                      <td class="whitespace-nowrap px-2 py-2 text-sm text-gray-500 dark:text-gray-200"><%= number_to_currency(campaign.recent_revenue(), unit: "$", precision: 0) %></td>
                      <td class="whitespace-nowrap px-2 py-2 text-sm text-gray-500 dark:text-gray-200"><%= number_to_currency(campaign.recent_profit(), unit: "$", precision: 0) %> <span class="text-sm">(<%= campaign.profit_margin %>%)</span></td>   

                      <td class="whitespace-nowrap px-2 py-2 text-sm <%= campaign.profit_change_percentage(1) < 0 ? "text-red-500" : "text-green-500" %>"><%= number_to_percentage(campaign.profit_change_percentage(1), precision: 0)   %></td> 

                      <td class="whitespace-nowrap px-2 py-2 text-sm text-gray-500 dark:text-gray-200"><%= number_with_delimiter(campaign.api_requests.where(direction: 'inbound').count) %></td>
                      <td class="whitespace-nowrap px-2 py-2 text-sm text-gray-500 dark:text-gray-200"><%= campaign.recent_acceptance_rate() %>%</td>
                    </tr>
                    <% end %>
                </tbody>
              </table>
              <% if @pagy.pages > 1 %>
                <div class="p-6">
                  <%== pagy_nav @pagy %>
                </div>
              <% end %>
            <% end %>
           <% else %>
              <div class="text-center p-8">
                <%= image_tag "empty.svg", class: "w-1/3 mb-4 m-auto" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>











